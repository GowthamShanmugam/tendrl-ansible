---

- name: Install tendrl repo
  get_url:
    url: https://copr.fedorainfracloud.org/coprs/tendrl/tendrl/repo/epel-7/tendrl-tendrl-epel-7.repo
    dest: /etc/yum.repos.d/tendrl-tendrl-epel-7.repo

- name: Activate EPEL
  package:
    name: http://mirror.netcologne.de/fedora-epel/epel-release-latest-7.noarch.rpm

- name: Ensure tendrl-node-agent is installed
  package:
    name: tendrl-node-agent
    state: latest

- name: Configure etcd connection for tendrl-noded
  lineinfile:
    dest: /etc/tendrl/tendrl.conf
    line: "etcd_connection = '{{ etcd_server_address }}'"
    regexp: '^etcd_connection'

- name: Start tendrl-noded and enable it on boot
  service:
    name: tendrl-noded
    enabled: yes
    state: started

# http://IP:2379/v2/keys/nodes should list all nodes